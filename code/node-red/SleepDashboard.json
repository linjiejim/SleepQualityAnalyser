[{"id":"684bc38a.cfb9fc","type":"function","z":"c57c0cd6.65f56","name":"Generate Recommendations","func":"tempRec = \"The temperature in your bedroom is just right!\";\nhumidRec = \"The humidity level in your room is just fine\";\nbrightRec = \"The room's brightness level is just perfect!\";\nmotionRec = \"There is no significant movements during your sleep\";\nnoiseRec = \"Your bedroom was perfectly quiet last night\";\nairRec = \"Your room has a good air quality\";\n\nconst arrAvg = arr => arr.reduce((a,b) => a + b, 0) / arr.length\n\nvar tempArr = msg.payload.map(a => a.SleepDataTemp);\nvar humidArr = msg.payload.map(a => a.SleepDataHumid);\nvar brightArr = msg.payload.map(a => a.SleepDataBright);\nvar motionArr = msg.payload.map(a => a.SleepDataMotion);\nvar noiseArr = msg.payload.map(a => a.SleepDataNoise);\nvar airArr = msg.payload.map(a => a.SleepDataAir);\n\n\n\nfor (i=0; i < tempArr.length; i++)\n{\n    if (tempArr[i] < 17 || tempArr[i] > 21){\n        tempRec = \"You might want to set your temperature to around 19 C for a better sleep experience\";\n    }\n    \n    if (humidArr[i] < 40){\n        humidRec = \"At some point last night your room was too dry.\";\n    }\n    else if (humidArr[i] > 60){\n        humidRec = \"The humidity level in your bedroom was a bit higher.\";\n    }\n    \n    if(airArr[i] > 700){\n        airRec = \"The level of air pollution in your room is high\";\n    }\n    else if(airArr[i] > 200){\n        airRec = \"The level of air pollution in your room is low\";\n    }\n    \n    if(noiseArr[i] > 500){\n        noiseRec = \"There were some noises in your bedroom last night that might disrupt your sleep\"\n    }\n}\n\n\nvar avgMotion = arrAvg(motionArr);\n\nif (avgMotion > 0.25){\n        motionRec = \"There seems to be a fair amount of movements during your sleep\";\n}\n\nvar avgBright = arrAvg(brightArr);\nif(avgBright > 10){\n        brightRec = \"Try turning off all lights in your bedroom\"\n}\n\n\nmsg.payload = {\n    'recommendations': {\n    'recommendation0': {'msg': tempRec},\n    'recommendation1': {'msg': brightRec},\n    'recommendation2': {'msg': humidRec},\n    'recommendation3': {'msg': motionRec},\n    'recommendation4': {'msg': noiseRec},\n    'recommendation5': {'msg': airRec}\n    }\n};\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":500,"wires":[["eae717b4.6c93f8","d7179bbb.213268"]]}]